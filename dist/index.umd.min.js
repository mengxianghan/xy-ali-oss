!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ali-oss")):"function"==typeof define&&define.amd?define(["ali-oss"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).AliOSS=e(t.OSS)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=e(t);function i(t={},e={}){let n;for(n in e)t[n]="[object Object]"===Object.prototype.toString.call(t[n])?i(t[n],e[n]):t[n]=e[n];return t}return class{constructor(t){this.opts={async:!1,accessKeyId:"",accessKeySecret:"",stsToken:"",bucket:"",endpoint:"",region:"oss-cn-hangzhou",internal:!1,cname:!1,isRequestPay:!1,secure:!0,timeout:"60s",config:{headers:{"Cache-Control":"public"}},refreshSTSTokenInterval:3e5,rootPath:"",getConfig:function(){},getToken:function(){},...t},this.client=null}async _init(t){try{if(!this.client){const{async:t}=this.opts;if(t){const t=await this.opts.getConfig();this.opts={...this.opts,...t||{}}}const{accessKeyId:e,accessKeySecret:i,stsToken:s,bucket:o,endpoint:c,region:a,internal:r,cname:u,isRequestPay:l,secure:p,timeout:h,getToken:f}=this.opts;this.client=new n.default({accessKeyId:e,accessKeySecret:i,stsToken:s,bucket:o,endpoint:c,region:a,internal:r,cname:u,isRequestPay:l,secure:p,timeout:h,refreshSTSToken:f})}["[object Function]","[object AsyncFunction]"].includes(Object.prototype.toString.call(t))&&t.call(this,this.client)}catch(t){console.error(t.message)}}upload(t,e,n={}){return new Promise(((s,o)=>{this._init((function(c){c.put(this._generateName(t),e,i(n,this.opts.config)).then((t=>{s(this._formatResult(t))})).catch((t=>{o(t)}))}))}))}async cancel(){await this._init((function(t){t.cancel()}))}multipartUpload(t,e,n={}){return new Promise((async(s,o)=>{await this._init((function(c){c.multipartUpload(this._generateName(t),e,i(n,this.opts.config)).then((t=>{s(this._formatResult(t))})).catch((t=>{o(t)}))}))}))}resumeMultipartUpload(t,e,n={}){return new Promise((async(s,o)=>{await this._init((function(c){c.multipartUpload(t,e,i(n,this.opts.config)).then((t=>{s(this._formatResult(t))})).catch((t=>{o(t)}))}))}))}abortMultipartUpload(t,e){return new Promise((async(n,i)=>{await this._init((function(s){s.abortMultipartUpload(t,e).then((t=>{n(t)})).catch((t=>{i(t)}))}))}))}_formatResult(t={}){const{name:e="",res:{status:n=500,size:i=0,requestUrls:s=[]}}=t;return{code:String(n),data:{name:e,url:s&&s.length?s[0]:"",suffix:e?`.${e.split(".").pop()}`:"",size:i}}}_generateName(t){if(!t)return"";const e=t.split(".").pop();return t.split("/").pop(),`${this.opts.rootPath}/${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}.${e}`.replace(new RegExp("^\\/"),"")}}}));
