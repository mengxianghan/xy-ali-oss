!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ali-oss")):"function"==typeof define&&define.amd?define(["ali-oss"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).Alioss=e(t.OSS)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var s=e(t);function n(t={},e={}){let s;for(s in e)t[s]="[object Object]"===Object.prototype.toString.call(t[s])?n(t[s],e[s]):t[s]=e[s];return t}return class{constructor(t){this.opts={async:!1,accessKeyId:"",accessKeySecret:"",stsToken:"",bucket:"",endpoint:"",region:"oss-cn-hangzhou",internal:!1,cname:!1,isRequestPay:!1,secure:!0,timeout:"60s",config:{headers:{"Cache-Control":"public"}},refreshSTSTokenInterval:3e5,rootPath:"",getConfig:function(){},getToken:function(){},...t},this.client=null}async _init(t){try{if(!this.client){const{async:t}=this.opts;if(t){const t=await this.opts.getConfig();this.opts={...this.opts,...t||{}}}const{accessKeyId:e,accessKeySecret:n,stsToken:i,bucket:o,endpoint:a,region:c,internal:r,cname:u,isRequestPay:l,secure:p,timeout:h,getToken:f}=this.opts;this.client=new s.default({accessKeyId:e,accessKeySecret:n,stsToken:i,bucket:o,endpoint:a,region:c,internal:r,cname:u,isRequestPay:l,secure:p,timeout:h,refreshSTSToken:f})}"[object Function]"===Object.prototype.toString.call(t)&&t.call(this,this.client)}catch(t){console.error(t.message)}}upload(t,e,s={}){return new Promise((async(i,o)=>{await this._init((async a=>{const c=await a.put(this._generateName(t),e,n(s,this.opts.config)).catch((t=>{o(t)}));i(this._formatResult(c))}))}))}async cancel(){await this._init((async t=>{t.cancel()}))}multipartUpload(t,e,s={}){return new Promise((async(i,o)=>{await this._init((async a=>{const c=await a.multipartUpload(this._generateName(t),e,n(s,this.opts.config)).catch((t=>{o(t)}));i(this._formatResult(c))}))}))}resumeMultipartUpload(t,e,s={}){return new Promise((async(i,o)=>{await this._init((async a=>{const c=await a.multipartUpload(t,e,n(s,this.opts.config)).catch((t=>{o(t)}));i(this._formatResult(c))}))}))}abortMultipartUpload(t,e){return new Promise((async(s,n)=>{await this._init((async i=>{const o=await i.abortMultipartUpload(t,e).catch((t=>{n(t)}));s(o)}))}))}_formatResult(t={}){const{name:e="",url:s="",res:{status:n=500,size:i=0}}=t;return{code:String(n),data:{name:e,url:s,suffix:e?`.${e.split(".").pop()}`:"",size:i}}}_generateName(t){if(!t)return"";const e=t.split(".").pop();return t.split("/").pop(),`${this.opts.rootPath}/${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}.${e}`.replace(new RegExp("^\\/"),"")}}}));
